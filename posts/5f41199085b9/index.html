<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Understanding Mutex in Go" /><meta name="author" content="Kamna Garg" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction" /><meta property="og:description" content="Introduction" /><link rel="canonical" href="/posts/5f41199085b9/" /><meta property="og:url" content="/posts/5f41199085b9/" /><meta property="og:site_name" content="Kamna" /><meta property="og:image" content="/assets/5f41199085b9/1*_FVk0JkZ3ML_nJD2SwF-4A.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-07-07T19:27:52+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="/assets/5f41199085b9/1*_FVk0JkZ3ML_nJD2SwF-4A.png" /><meta property="twitter:title" content="Understanding Mutex in Go" /><meta name="twitter:site" content="@kamna90" /><meta name="twitter:creator" content="@Kamna Garg" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Kamna Garg"},"dateModified":"2023-07-07T19:27:52+00:00","datePublished":"2023-07-07T19:27:52+00:00","description":"Introduction","headline":"Understanding Mutex in Go","image":"/assets/5f41199085b9/1*_FVk0JkZ3ML_nJD2SwF-4A.png","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/5f41199085b9/"},"url":"/posts/5f41199085b9/"}</script><title>Understanding Mutex in Go | Kamna</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Kamna"><meta name="application-name" content="Kamna"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/1621252237275.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">Kamna</a></div><div class="site-subtitle font-italic">Womanwhocode</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="javascript:location.href = 'mailto:' + ['kamna90123','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Understanding Mutex in Go</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Understanding Mutex in Go</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1688758072" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 7, 2023 </em> </span> <span> Updated <em class="" data-ts="1688758072" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 7, 2023 </em> </span><div class="mt-3 mb-3"> <a href="/assets/5f41199085b9/1*_FVk0JkZ3ML_nJD2SwF-4A.png" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/5f41199085b9/1*_FVk0JkZ3ML_nJD2SwF-4A.png" alt="Preview Image" width="1200" height="630" class="lazyload" data-proofer-ignore></a></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1383 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h3 id="understanding-mutex-in-go"><span class="mr-2">Understanding Mutex in Go</span><a href="#understanding-mutex-in-go" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/5f41199085b9/1*_FVk0JkZ3ML_nJD2SwF-4A.png" class="popup img-link "><img data-src="/assets/5f41199085b9/1*_FVk0JkZ3ML_nJD2SwF-4A.png" alt="Image source: google" class="lazyload" data-proofer-ignore></a></p><p>Image source: google</p><h4 id="introduction"><span class="mr-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>In concurrent programming, ensuring data integrity and preventing race conditions is crucial. In Go, the <code class="language-plaintext highlighter-rouge">sync.Mutex</code> type provides a simple and effective way to achieve mutual exclusion and control concurrent access to shared resources. In this blog post, we will explore the concept of mutexes, understand how to use them in Go, and discuss their internals, and their role in solving race conditions.</p><h4 id="what-is-a-mutex-and-how-it-solves-race-conditions"><span class="mr-2">What is a Mutex and how it solves race conditions:</span><a href="#what-is-a-mutex-and-how-it-solves-race-conditions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>A mutex, short for mutual exclusion, is used to protect shared resources from simultaneous access by multiple goroutines. It ensures that only one goroutine can access a critical section of code at a time. Race conditions occur when multiple goroutines access and modify shared data concurrently, leading to unpredictable and erroneous behavior. Mutexes prevent race conditions by allowing only one goroutine to acquire the lock and access the shared resource, while other goroutines wait until the lock is released.</p><p>Mutexes are data structures provided by the standard <a href="https://pkg.go.dev/sync/" target="_blank">sync</a> package.</p><h4 id="understanding-mutex-internals"><span class="mr-2">Understanding Mutex Internals</span><a href="#understanding-mutex-internals" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Let’s try to understand how mutex prevents race conditions. It’s time to delve into the internals of mutex.</p><p>Internally, the <code class="language-plaintext highlighter-rouge">sync.Mutex</code> type in Go utilizes low-level atomic operations provided by the underlying processor architecture. These atomic operations ensure that the mutex operations themselves are thread-safe and efficient.</p><p>To understand the role of low-level atomic operations, let’s take a closer look at the implementation of the <code class="language-plaintext highlighter-rouge">sync.Mutex</code> type. While the exact implementation details may vary depending on the target platform, we can examine a simplified version that highlights the essential elements:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"sync"</span>
<span class="p">)</span>

<span class="k">var</span> <span class="n">counter</span> <span class="o">=</span> <span class="m">0</span>

<span class="k">func</span> <span class="n">increment</span><span class="p">(</span><span class="n">wg</span> <span class="o">*</span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">counter</span><span class="o">++</span>
	<span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
	<span class="n">expectedCounter</span> <span class="o">:=</span> <span class="m">1000</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">expectedCounter</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
		<span class="k">go</span> <span class="n">increment</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wg</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Expected Counter:"</span><span class="p">,</span> <span class="n">expectedCounter</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Actual Counter:"</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
	<span class="c">// Check for race condition</span>
	<span class="k">if</span> <span class="n">expectedCounter</span> <span class="o">!=</span> <span class="n">counter</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Race condition detected!"</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"No race condition detected."</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In the simplified implementation above, the <code class="language-plaintext highlighter-rouge">Mutex</code> struct includes a <code class="language-plaintext highlighter-rouge">state</code> variable, which represents the lock’s state, and a <code class="language-plaintext highlighter-rouge">sema</code> variable, which is a semaphore used for blocking and waking up goroutines.</p><p>The <code class="language-plaintext highlighter-rouge">Lock()</code> method attempts to acquire the lock by using the <code class="language-plaintext highlighter-rouge">atomic.CompareAndSwapInt32()</code> function. This function atomically compares the <code class="language-plaintext highlighter-rouge">state</code> variable’s value with 0 and swaps it with 1 if they are equal. If the swap is successful, the lock is acquired without blocking. Otherwise, the <code class="language-plaintext highlighter-rouge">Lock()</code> method calls <code class="language-plaintext highlighter-rouge">runtime_SemacquireMutex()</code> to wait for the lock to become available.</p><p>The <code class="language-plaintext highlighter-rouge">Unlock()</code> method releases the lock by using the <code class="language-plaintext highlighter-rouge">atomic.CompareAndSwapInt32()</code> function again. It compares the <code class="language-plaintext highlighter-rouge">state</code> variable’s value with 1 and swaps it with 0 if they are equal. If the swap is successful, indicating that the lock was held, the <code class="language-plaintext highlighter-rouge">Unlock()</code> method calls <code class="language-plaintext highlighter-rouge">runtime_SemreleaseMutex()</code> to wake up any waiting goroutine.</p><p>The use of atomic operations ensures that the lock’s state is updated atomically, without interference from other goroutines. This atomicity guarantees thread safety and eliminates the need for additional locks or synchronization mechanisms.</p><h4 id="how-to-prevent-race-conditions"><span class="mr-2">How to prevent race conditions</span><a href="#how-to-prevent-race-conditions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>In Go, the <code class="language-plaintext highlighter-rouge">sync</code> package provides the <code class="language-plaintext highlighter-rouge">Mutex</code> type, which includes two main methods: <code class="language-plaintext highlighter-rouge">Lock()</code> and <code class="language-plaintext highlighter-rouge">Unlock()</code> .</p><p>To understand how a mutex solves race conditions, let’s consider an example without using a mutex:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"sync"</span>
<span class="p">)</span>

<span class="k">var</span> <span class="n">counter</span> <span class="o">=</span> <span class="m">0</span>

<span class="k">func</span> <span class="n">increment</span><span class="p">(</span><span class="n">wg</span> <span class="o">*</span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">counter</span><span class="o">++</span>
	<span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
	<span class="n">expectedCounter</span> <span class="o">:=</span> <span class="m">1000</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">expectedCounter</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
		<span class="k">go</span> <span class="n">increment</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wg</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Expected Counter:"</span><span class="p">,</span> <span class="n">expectedCounter</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Actual Counter:"</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
	<span class="c">// Check for race condition</span>
	<span class="k">if</span> <span class="n">expectedCounter</span> <span class="o">!=</span> <span class="n">counter</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Race condition detected!"</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"No race condition detected."</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Below is the output :</p><p><a href="/assets/5f41199085b9/1*50cd_ccnb4DV108v8SEqaw.png" class="popup img-link "><img data-src="/assets/5f41199085b9/1*50cd_ccnb4DV108v8SEqaw.png" alt="Output" class="lazyload" data-proofer-ignore></a></p><p>Output</p><p>Here multiple goroutines are simultaneously reading and updating the value of the counter without any proper synchronization.</p><p><a href="/assets/5f41199085b9/1*Yy0ahT_CoyVc6_Xb0dNi3Q.png" class="popup img-link "><img data-src="/assets/5f41199085b9/1*Yy0ahT_CoyVc6_Xb0dNi3Q.png" alt="Race condition" class="lazyload" data-proofer-ignore></a></p><p>Race condition</p><p>We need to use the <code class="language-plaintext highlighter-rouge">sync.Mutex</code> type to prevent multiple goroutines from accessing <code class="language-plaintext highlighter-rouge">counter</code> at the same time:</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"sync"</span>
<span class="p">)</span>

<span class="k">var</span> <span class="n">counter</span> <span class="o">=</span> <span class="m">0</span>
<span class="k">var</span> <span class="n">mutex</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>

<span class="k">func</span> <span class="n">increment</span><span class="p">(</span><span class="n">wg</span> <span class="o">*</span><span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">mutex</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
	<span class="n">counter</span><span class="o">++</span>
	<span class="n">mutex</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
	<span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
	<span class="n">expectedCounter</span> <span class="o">:=</span> <span class="m">1000</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">expectedCounter</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span> <span class="p">{</span>
		<span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>
		<span class="k">go</span> <span class="n">increment</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wg</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Expected Counter:"</span><span class="p">,</span> <span class="n">expectedCounter</span><span class="p">)</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Actual Counter:"</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>

	<span class="c">// Check for race condition</span>
	<span class="k">if</span> <span class="n">expectedCounter</span> <span class="o">!=</span> <span class="n">counter</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Race condition detected!"</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"No race condition detected."</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Below is the output:</p><p><a href="/assets/5f41199085b9/1*9UVZDf4wDNcYUiLgyD700A.png" class="popup img-link "><img data-src="/assets/5f41199085b9/1*9UVZDf4wDNcYUiLgyD700A.png" alt="Output" class="lazyload" data-proofer-ignore></a></p><p>Output</p><p><a href="/assets/5f41199085b9/1*VNS-44mwb-4NVI6mmYx9LA.png" class="popup img-link "><img data-src="/assets/5f41199085b9/1*VNS-44mwb-4NVI6mmYx9LA.png" alt="No race conditions" class="lazyload" data-proofer-ignore></a></p><p>No race conditions</p><h4 id="where-not-to-use-mutex"><span class="mr-2">Where Not to Use Mutex</span><a href="#where-not-to-use-mutex" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><ol><li><strong>High Contention</strong> : If many goroutines are frequently trying for the same lock, the performance of mutexes can degrade. In such cases, consider using alternative synchronization primitives like <code class="language-plaintext highlighter-rouge">sync.RWMutex</code> or channel-based communication patterns.<li><strong>Deadlock Risks</strong> : Improper use of mutexes can lead to deadlocks, where goroutines end up waiting indefinitely for a lock to be released. Avoid complex nesting of locks or forgetting to unlock the mutex.</ol><h4 id="using-defer-with-unlock"><span class="mr-2">Using <code class="language-plaintext highlighter-rouge">defer</code> with <code class="language-plaintext highlighter-rouge">Unlock()</code></span><a href="#using-defer-with-unlock" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>It is very easy to miss unlocking the mutex.</p><blockquote><p><strong>Whenever you call the <code class="language-plaintext highlighter-rouge">Lock</code> method, you must ensure that <code class="language-plaintext highlighter-rouge">Unlock</code> is eventually called, otherwise any goroutine trying to acquire the same lock will be blocked forever.</strong></p></blockquote><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"sync"</span>
<span class="p">)</span>

<span class="k">var</span> <span class="n">mutex</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
	<span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>

	<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
		<span class="n">mutex</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span> <span class="c">// will wait here indefinitely if Goroutine 2 acquires lock first</span>

		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Goroutine 1 acquired the lock"</span><span class="p">)</span>
		<span class="n">n</span> <span class="o">:=</span> <span class="m">2</span>
		<span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="m">2</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
			<span class="k">return</span>
		<span class="p">}</span>
		<span class="n">mutex</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span> <span class="c">// mutex is never unlocked</span>

	<span class="p">}()</span>
	<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
		<span class="n">mutex</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span> <span class="c">// will wait here indefinitely if Goroutine 1 acquires lock first</span>

		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Goroutine 2 acquired the lock"</span><span class="p">)</span>

		<span class="n">n</span> <span class="o">:=</span> <span class="m">2</span>
		<span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="m">2</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
			<span class="k">return</span>
		<span class="p">}</span>
		<span class="n">mutex</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span> <span class="c">// mutex is never unlocked</span>

	<span class="p">}()</span>
	<span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Main goroutine completed"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In the above example, if either goroutine1 or goroutine2 acquires the lock, the unlocked goroutine will wait for the lock indefinitely. Here the if condition is always true and it will never unlock the mutex.</p><p><a href="/assets/5f41199085b9/1*7jA33Wr-Nt08GfDSQce82g.png" class="popup img-link "><img data-src="/assets/5f41199085b9/1*7jA33Wr-Nt08GfDSQce82g.png" alt="output" class="lazyload" data-proofer-ignore></a></p><p>output</p><p>We can use defer here to prevent such kind of scenarios. Without defer, forgetting to manually release the lock before returning from a function can lead to deadlocks, where a goroutine may be blocked indefinitely.</p><div class="language-go highlighter-rouge"><div class="code-header"> <span data-label-text="Go"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
	<span class="s">"fmt"</span>
	<span class="s">"sync"</span>
<span class="p">)</span>

<span class="k">var</span> <span class="n">mutex</span> <span class="n">sync</span><span class="o">.</span><span class="n">Mutex</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">var</span> <span class="n">wg</span> <span class="n">sync</span><span class="o">.</span><span class="n">WaitGroup</span>
	<span class="n">wg</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>

	<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
		<span class="n">mutex</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
		<span class="k">defer</span> <span class="n">mutex</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Goroutine 1 acquired the lock"</span><span class="p">)</span>
		<span class="n">n</span> <span class="o">:=</span> <span class="m">2</span>
		<span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="m">2</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
			<span class="k">return</span>
		<span class="p">}</span>

	<span class="p">}()</span>
	<span class="k">go</span> <span class="k">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">defer</span> <span class="n">wg</span><span class="o">.</span><span class="n">Done</span><span class="p">()</span>
		<span class="n">mutex</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
		<span class="k">defer</span> <span class="n">mutex</span><span class="o">.</span><span class="n">Unlock</span><span class="p">()</span>
		<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Goroutine 2 acquired the lock"</span><span class="p">)</span>

		<span class="n">n</span> <span class="o">:=</span> <span class="m">2</span>
		<span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="m">2</span> <span class="o">==</span> <span class="m">0</span> <span class="p">{</span>
			<span class="k">return</span>
		<span class="p">}</span>

	<span class="p">}()</span>
	<span class="n">wg</span><span class="o">.</span><span class="n">Wait</span><span class="p">()</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Println</span><span class="p">(</span><span class="s">"Main goroutine completed"</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p><a href="/assets/5f41199085b9/1*Hhq2fAE8_tXL65mLYqY_bw.png" class="popup img-link "><img data-src="/assets/5f41199085b9/1*Hhq2fAE8_tXL65mLYqY_bw.png" alt="output" class="lazyload" data-proofer-ignore></a></p><p>output</p><p>The <code class="language-plaintext highlighter-rouge">defer</code> statement in Go allows us to postpone the execution of a function until the surrounding function returns. By deferring the <code class="language-plaintext highlighter-rouge">Unlock()</code> method immediately after acquiring the lock, we ensure that the mutex will always be released, even if an error occurs or a panic is triggered.</p><h4 id="conclusion"><span class="mr-2">Conclusion</span><a href="#conclusion" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Mutexes play a crucial role in concurrent programming to ensure proper synchronization and prevent race conditions. By using the <code class="language-plaintext highlighter-rouge">sync.Mutex</code> type in Go, developers can protect shared resources and control access to critical sections of code.</p><p>If you would like to view the full codebase, please visit the repository by clicking here: <a href="https://github.com/kamna123/mutex-tutorial/tree/main" target="_blank"><strong>Repo</strong></a></p><p><em><a href="https://kamnagarg-10157.medium.com/understanding-mutex-in-go-5f41199085b9" target="_blank">Post</a> converted from Medium by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</em></p></div><div class="post-tail-wrapper text-muted"><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/golang/" class="post-tag no-text-decoration" >golang</a> <a href="/tags/mutex/" class="post-tag no-text-decoration" >mutex</a> <a href="/tags/concurrency/" class="post-tag no-text-decoration" >concurrency</a> <a href="/tags/deadlock/" class="post-tag no-text-decoration" >deadlock</a> <a href="/tags/defer/" class="post-tag no-text-decoration" >defer</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Understanding%20Mutex%20in%20Go%20-%20Kamna&url=%2Fposts%2F5f41199085b9%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Understanding%20Mutex%20in%20Go%20-%20Kamna&u=%2Fposts%2F5f41199085b9%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fposts%2F5f41199085b9%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/ff56d35a891f/">Mastering Asynchronous Programming with Kotlin Coroutines — Part 1</a><li><a href="/posts/ed48312c0e80/">Think, Stick and just go</a><li><a href="/posts/34d9d3a5565b/">Exploring Context in Golang</a><li><a href="/posts/f01ac6e884dc/">Exploring the Internals of Channels in Go</a><li><a href="/posts/40902c487f04/">Demystifying Kubernetes: Part 1</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/backend-development/">backend-development</a> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/boyer-moore/">boyer-moore</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/deadlock/">deadlock</a> <a class="post-tag" href="/tags/defer/">defer</a> <a class="post-tag" href="/tags/design-patterns/">design-patterns</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/678dd07129a2/"><div class="card-body"> <em class="small" data-ts="1684256201" data-df="ll" > May 16, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Demystifying Load Balancing in Go: A Comprehensive Guide</h3><div class="text-muted small"><p> Demystifying Load Balancing in Go: A Comprehensive Guide Load balancing is a crucial technique used to distribute incoming traffic across multiple backend servers, ensuring optimal performance, sc...</p></div></div></a></div><div class="card"> <a href="/posts/fe2d7a895ab3/"><div class="card-body"> <em class="small" data-ts="1684347531" data-df="ll" > May 17, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Exploring Design Patterns in Go</h3><div class="text-muted small"><p> Exploring Design Patterns in Go Design patterns are reusable solutions to common software design problems that help developers build software that is maintainable, extensible, and scalable. In thi...</p></div></div></a></div><div class="card"> <a href="/posts/93eb6138f1c0/"><div class="card-body"> <em class="small" data-ts="1684606359" data-df="ll" > May 20, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Protocol Buffers (ProtoBuf) in Go</h3><div class="text-muted small"><p> Protocol Buffers (ProtoBuf) in Go Buckle up, folks! This time we’re diving into the world of Protocol Buffers (protobuf) and their superpowers in data serialization. Introduction Protocol Buffers...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/34d9d3a5565b/" class="btn btn-outline-primary" prompt="Older"><p>Exploring Context in Golang</p></a> <a href="/posts/496955847700/" class="btn btn-outline-primary" prompt="Newer"><p>Learn Docker through Hands-on Examples</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/golang/">golang</a> <a class="post-tag" href="/tags/backend-development/">backend-development</a> <a class="post-tag" href="/tags/backend/">backend</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/boyer-moore/">boyer-moore</a> <a class="post-tag" href="/tags/concurrency/">concurrency</a> <a class="post-tag" href="/tags/database/">database</a> <a class="post-tag" href="/tags/deadlock/">deadlock</a> <a class="post-tag" href="/tags/defer/">defer</a> <a class="post-tag" href="/tags/design-patterns/">design-patterns</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/kamna90">kamna</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">All rights reserved.</span></p></div><div class="footer-right"><p class="mb-0">Using the <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
